<script>
/*
	1. 코드흐름 : 
		* Array Parser함수를 만든다! 
			- 문자열을 인자로 받는다. 
			- 문자열 안에는 배열 형태로 되어 있다.
			- 배열형태로 되어있는 문자열을 배열로 만들어준다.
			- 배열의 형태로 변경된 문자열을 type과 value와 child를 분석한다!!
	2. 함수명, 변수명 설정 : 
		1. str : 배열의 형태로 된 문자열이다.
		2. pipe함수 : pipe함수로 여러 함수들을 인자로 받아 첫번째함수의 리턴값을 두번째함수의 
		인자값으로 받고 두번째 함수의 리턴값을 세번째함수의 인자값으로 받아 쭉 실행한다.
		3. arrayFromString : 문자열에서 문자한개한개가 원소값인 배열을 만들어준다. 공백은 제거한다. 맨앞의 "["와 맨끝의 "]"는 제거한다.
		4. combineElements : 한개한개문자열에서 배열형태의 문자 "["과 "]"이 있다면 그 사이에 있는 문자인 원소를 하나의 문자열로 합쳐준다.
		5. makeArray : ','이라는 문자를 기준으로 문자를 합쳐 문자열을 만들어주고 그 문자열을 원소값으로 가지는 배열을 만든다.
		6. changeStringToArray : 3번과 4번과 5번은 pipe함수로 연결하여 changeStringToArray을 만들어준다.
		7. arrayParser : str을 인자로 받아 type과 value와 child를 분석한다!

*/
let str = "[123, [12,[23,55]], [33,55]]";
const pipe = (...fns) => (value) => fns.reduce( (acc, fn) => fn(acc), value);

function arrayFromString(str){

	let newArray = Array.from(str).map(v => v.trim()).filter(v => v.length > 0);
	newArray = newArray.slice(1,newArray.length - 1);
	return newArray;
}

function combineElements(newArray){

	if( !newArray.includes("[") )return newArray;
	const dic = newArray.reduce( (prev, curr, i ) => {
		if( curr === "[" || curr === "]" ){
			prev[i] = curr;
			return prev;
		}else{ return prev; }
	},{});
	let count = 0;
	for( let key in dic ){
		if( dic[key] === "[") count++;
		if( dic[key] === "]") count--;
		if( count === 0 ){
			const startIndex = newArray.indexOf("[");
			const lastIndex = +key;
			const changeString = newArray.slice(startIndex, lastIndex+1).reduce( (prev, curr) => prev+curr);
			newArray.splice(startIndex, changeString.length, changeString);
			return combineElements(newArray);
		}
	}

}

function makeArray(newArray){

	let valueOfArray = "";
	let makeArray = [];
	for(let i = 0; i < newArray.length; i++){
		if(newArray[i] === ","){
			makeArray.push(valueOfArray);
			valueOfArray = "";
			continue;
		}
		valueOfArray += newArray[i];
	}
	makeArray.push(valueOfArray);
	return makeArray;
}

const changeStringToArray = pipe(arrayFromString, combineElements, makeArray);

function arrayParser(str){

	let result;
	if(typeof str === "string"){
		const parsingArray = changeStringToArray(str);
		let dic = {};
		dic.type = "array";
		dic.value = "ArrayObject"
		dic.child = arrayParser(parsingArray);
		result = dic;
	}else{
		result = str.reduce((prev, curr) => {
			if(curr[0] === "["){
				return prev.concat(arrayParser(curr));
			}else{
				let dic = {};
				dic.type = "number";
				dic.value = curr;
				dic.child = [];
				return prev.concat(dic);
			}
		}, []);
	}

	return result;
}

const result = arrayParser(str);
console.log(JSON.stringify(result, null, 2)); 
</script>